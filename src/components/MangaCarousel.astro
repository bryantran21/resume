---
interface Manga {
  title: string;
  author: string;
  volumes: number;
  chapters: number;
  coverImage: string;
  completed: boolean;
}

interface Props {
  mangas?: Manga[];
}

const { mangas = [] } = Astro.props;
---

<div class="carousel-container">
  <div class="carousel" id="manga-carousel">
    {mangas.map((manga, index) => (
      <div class="carousel-item" data-index={index}>
        <div class="manga-card-3d">
          <img src={manga.coverImage} alt={manga.title} class="manga-image" />
          <div class="manga-overlay">
            <h3>{manga.title}</h3>
            <div class="manga-stats">
              <span>{manga.volumes} Volumes</span>
              <span>{manga.chapters} Chapters</span>
              <span>Author: {manga.author}</span>
            </div>
          </div>
        </div>
      </div>
    ))}
    {mangas.length === 0 && <p class="empty-msg">No mangas to display yet!</p>}
  </div>

  <button class="carousel-btn prev" id="prev-btn">
    <i class="fas fa-chevron-left"></i>
  </button>
  <button class="carousel-btn next" id="next-btn">
    <i class="fas fa-chevron-right"></i>
  </button>

  <div class="carousel-indicators">
    {mangas.map((_, index) => (
      <button class="indicator" data-index={index}></button>
    ))}
  </div>
</div>

<style>
.carousel-container {
  position: relative;
  width: 100%;
  height: 500px;
  perspective: 1200px;
  margin: 3rem 0;
}

.carousel {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  transition: transform 0.6s ease;
}

.carousel-item {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 300px;
  height: 450px;
  transform-style: preserve-3d;
  transition: all 0.6s ease;
}

.manga-card-3d {
  width: 100%;
  height: 100%;
  position: relative;
  border-radius: 1rem;
  overflow: hidden;
  box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
  transition: all 0.3s ease;
}

.carousel-item.active .manga-card-3d {
  box-shadow: 0 20px 60px rgba(96, 165, 250, 0.4);
}

.manga-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.manga-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
  padding: 1.5rem;
  transform: translateY(100%);
  transition: transform 0.3s ease;
}

.carousel-item.active .manga-overlay {
  transform: translateY(0);
}

.manga-overlay h3 {
  font-size: 1.25rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
}

.manga-badge {
  display: inline-block;
  padding: 0.25rem 0.75rem;
  border-radius: 1rem;
  font-weight: 600;
  font-size: 0.85rem;
  margin-bottom: 0.75rem;
  color: white;
  background: #fbbf24;
}

.manga-badge.completed {
  background: #10b981;
}

.manga-stats {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  font-size: 0.85rem;
  color: rgba(255, 255, 255, 0.8);
}

.carousel-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 50px;
  height: 50px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  color: white;
  font-size: 1.25rem;
  cursor: pointer;
  z-index: 10;
  transition: all 0.3s;
  backdrop-filter: blur(10px);
}

.carousel-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateY(-50%) scale(1.1);
}

.carousel-btn.prev { left: 2rem; }
.carousel-btn.next { right: 2rem; }

.carousel-indicators {
  position: absolute;
  bottom: -3rem;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 0.5rem;
}

.indicator {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.3);
  border: none;
  cursor: pointer;
  transition: all 0.3s;
}

.indicator.active {
  background: #60a5fa;
  width: 30px;
  border-radius: 5px;
}

.empty-msg {
  color: rgba(255,255,255,0.7);
  text-align: center;
  position: absolute;
  width: 100%;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.2rem;
}

/* Mobile */
@media (max-width: 768px) {
  .carousel-container { height: 400px; }
  .carousel-item { width: 200px; height: 300px; }
  .carousel-btn { width: 40px; height: 40px; }
  .carousel-btn.prev { left: 0.5rem; }
  .carousel-btn.next { right: 0.5rem; }
}
</style>

<script>
const carousel = document.getElementById('manga-carousel');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const items = document.querySelectorAll('.carousel-item');
const indicators = document.querySelectorAll('.indicator');

let currentIndex = 0;
const totalItems = items.length;

function updateCarousel() {
  items.forEach((item, index) => {
    item.classList.remove('active');

    const distance = 300; // distance from center
    const offset = index - currentIndex;

    if (index === currentIndex) {
      item.style.transform = `translate(-50%, -50%) translateZ(150px) scale(1)`;
      item.style.opacity = '1';
      item.style.zIndex = '10';
      item.classList.add('active');
    } else {
      const x = Math.sin((offset * 360 / totalItems) * Math.PI / 180) * distance;
      const z = Math.cos((offset * 360 / totalItems) * Math.PI / 180) * distance - 150;
      item.style.transform = `translate(-50%, -50%) translateX(${x}px) translateZ(${z}px) scale(0.7)`;
      item.style.opacity = z > -300 ? '0.5' : '0';
      item.style.zIndex = Math.round(z);
    }
  });

  indicators.forEach((indicator, index) => {
    indicator.classList.toggle('active', index === currentIndex);
  });
}

function next() {
  currentIndex = (currentIndex + 1) % totalItems;
  updateCarousel();
}

function prev() {
  currentIndex = (currentIndex - 1 + totalItems) % totalItems;
  updateCarousel();
}

prevBtn?.addEventListener('click', prev);
nextBtn?.addEventListener('click', next);

indicators.forEach((indicator, index) => {
  indicator.addEventListener('click', () => {
    currentIndex = index;
    updateCarousel();
  });
});

// Keyboard navigation
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft') prev();
  if (e.key === 'ArrowRight') next();
});

// Initialize
updateCarousel();
</script>
